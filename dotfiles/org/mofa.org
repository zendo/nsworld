#+STARTUP: show2levels indent hidestars

* clash
https://xtls.github.io/
https://wiki.metacubex.one/config/

#+begin_src yaml
# https://linux.do/t/topic/487334
# åŸºæœ¬è®¾ç½®
port: 7890        # HTTPä»£ç†ç«¯å£
socks-port: 7891  # SOCKSä»£ç†ç«¯å£
allow-lan: false  # å…è®¸å±€åŸŸç½‘è¿æ¥
bind-address: "*" # ç»‘å®šåœ°å€ï¼Œ* è¡¨ç¤ºæ‰€æœ‰åœ°å€
mode: rule        # ä»£ç†æ¨¡å¼ï¼Œruleè¡¨ç¤ºè§„åˆ™æ¨¡å¼
log-level: info   # æ—¥å¿—çº§åˆ«
ipv6: false

# å¤–éƒ¨æ§åˆ¶é…ç½®
external-controller: 127.0.0.1:9090 # å…è®¸é€šè¿‡ RESTful API æˆ– Web ç•Œé¢ï¼ˆå¦‚ Clash Dashboardï¼‰åœ¨æœ¬åœ°æ§åˆ¶ Clash
secret: jkfdjk43#$#@LI#@fsdf3  #å¤–éƒ¨æ§åˆ¶,apiè®¿é—®å¯†é’¥ï¼Œç¡®ä¿åªæœ‰çŸ¥é“å¯†ç çš„äººæ‰èƒ½æ§åˆ¶ Clash

# æ€§èƒ½ä¼˜åŒ–
unified-delay: true       # æ›´æ¢å»¶è¿Ÿè®¡ç®—æ–¹å¼ï¼Œå»é™¤æ¡æ‰‹ç­‰é¢å¤–å»¶è¿Ÿ
tcp-concurrent: true      # å¯ç”¨ TCP å¹¶å‘è¿æ¥ã€‚è¿™å…è®¸ Clash åŒæ—¶å»ºç«‹å¤šä¸ª TCP è¿æ¥ï¼Œå¯ä»¥æé«˜ç½‘ç»œæ€§èƒ½å’Œè¿æ¥é€Ÿåº¦

find-process-mode: strict  # è®¾ç½®è¿›ç¨‹æŸ¥æ‰¾æ¨¡å¼ä¸ºä¸¥æ ¼æ¨¡å¼ï¼ŒClash ä¼šæ›´ç²¾ç¡®åœ°è¯†åˆ«å’ŒåŒ¹é…ç½‘ç»œæµé‡æ¥æºçš„è¿›ç¨‹
global-client-fingerprint: chrome  # è®¾ç½®å…¨å±€å®¢æˆ·ç«¯æŒ‡çº¹ä¸º Chromeï¼Œä½¿ Clash åœ¨å»ºç«‹è¿æ¥æ—¶æ¨¡æ‹Ÿ Chrome æµè§ˆå™¨çš„ TLS æŒ‡çº¹ï¼Œå¢å¼ºéšç§æ€§å’Œç»•è¿‡æŸäº›ç½‘ç«™çš„æŒ‡çº¹æ£€æµ‹


# DNSé…ç½®
dns:
  enable: true                 # å¯ç”¨ Clash çš„ DNS åŠŸèƒ½
  ipv6: false                  # IPv6 DNS è§£æ
  listen: '0.0.0.0:53'         # DNS æœåŠ¡å™¨ç›‘å¬åœ°å€å’Œç«¯å£ï¼Œ:53 è¡¨ç¤ºç›‘å¬æ‰€æœ‰æ¥å£çš„ 53 ç«¯å£
  enhanced-mode: fake-ip       # è®¾ç½®å¢å¼ºæ¨¡å¼ä¸º fake-ip æ¨¡å¼ï¼Œæé«˜è§£æé€Ÿåº¦å’Œè¿æ¥æ€§èƒ½
  fake-ip-range: 198.18.0.1/16 # è®¾ç½® fake-ip çš„ IP åœ°å€èŒƒå›´ä¸º 198.18.0.1/16
  use-hosts: true              # å¯ç”¨ hosts æ–‡ä»¶è§£æï¼ŒClash ä¼šæ£€æŸ¥ç³»ç»Ÿçš„ hosts æ–‡ä»¶
  use-system-hosts: true       # ä½¿ç”¨ç³»ç»Ÿçš„ hosts æ–‡ä»¶è¿›è¡ŒåŸŸåè§£æ
  prefer-h3: true              # å¦‚æœDNSæœåŠ¡å™¨æ”¯æŒDoH3ä¼šä¼˜å…ˆä½¿ç”¨h3ï¼Œæå‡æ€§èƒ½
  respect-rules: true          # è®© DNS è§£æéµå¾ª Clash çš„è·¯ç”±è§„åˆ™
  # å®šä¹‰ä¸ä½¿ç”¨è™šå‡IPè§£æçš„åŸŸååˆ—è¡¨
  fake-ip-filter:
    - '*.lan'
    - localhost.ptlogin2.qq.com
    - '+.srv.nintendo.net'
    - '+.stun.playstation.net'
    - '+.msftconnecttest.com'
    - '+.msftncsi.com'
    - '+.xboxlive.com'
    - 'xbox.*.microsoft.com'
    - '*.battlenet.com.cn'
    - '*.battlenet.com'
    - '*.blzstatic.cn'
    - '*.battle.net'
  

  # ç”¨æ¥è§£æ nameserver å’Œ fallback é‡Œé¢çš„åŸŸåçš„ï¼Œå¿…é¡»ä¸º IP, å¯ä¸ºåŠ å¯† DNS
  default-nameserver: [223.5.5.5, 119.29.29.29]
  # 8.8.8.8           # Google DNS
  # 1.1.1.1           # Cloudflare DNS
  # 119.29.29.29      # è…¾è®¯DNSPod
  # 223.5.5.5         # é˜¿é‡ŒDNS
  # 223.6.6.6         # é˜¿é‡ŒDNS
  # 180.76.76.76      # ç™¾åº¦DNS

  # ç”¨äºdirectå‡ºå£åŸŸåè§£æçš„ DNS æœåŠ¡å™¨
  # å¦‚æœä¸å¡«åˆ™éµå¾ªnameserver-policyã€nameserverå’Œfallbackçš„é…ç½®
  direct-nameserver: ['https://doh.pub/dns-query', 'https://dns.alidns.com/dns-query']
  nameserver: ['https://8.8.8.8/dns-query#ğŸš€ èŠ‚ç‚¹é€‰æ‹©', 'https://1.1.1.1/dns-query#ğŸš€ èŠ‚ç‚¹é€‰æ‹©']

  # è§£æä»£ç†æœåŠ¡å™¨åŸŸåçš„DNSæœåŠ¡å™¨,å°±æ˜¯èŠ‚ç‚¹æœ¬èº«ä¸­åŒ…å«çš„åŸŸå
  # ä»£ç†èŠ‚ç‚¹åŸŸåè§£ææœåŠ¡å™¨ï¼Œä»…ç”¨äºè§£æä»£ç†èŠ‚ç‚¹çš„åŸŸåï¼Œå¦‚æœä¸å¡«åˆ™éµå¾ªnameserver-policyã€nameserverå’Œfallbackçš„é…ç½®
  proxy-server-nameserver:
    - https://1.1.1.1/dns-query          # Cloudflare DNS
    - https://8.8.8.8/dns-query          # Google DNS
    - https://doh.pub/dns-query          #è…¾è®¯
    - https://dns.alidns.com/dns-query   #é˜¿é‡Œ
    - https://9.9.9.9/dns-query          #Quad9
    - https://208.67.222.222/dns-query   #OpenDNS

# é…ç½®æ–‡ä»¶ç®¡ç†
profile:
  store-selected: true    # ä¿å­˜ç”¨æˆ·é€‰æ‹©çš„ä»£ç†é…ç½®ï¼Œåœ¨ Clash é‡å¯åä»ç„¶è®°ä½ä¸Šæ¬¡é€‰æ‹©çš„ä»£ç†æœåŠ¡å™¨
  store-fake-ip: true     # é€‚ç”¨äº Clash åœ¨ Fake IP æ¨¡å¼ä¸‹å·¥ä½œæ—¶ã€‚å®ƒä¼šå°†åŸŸååˆ° Fake IP çš„æ˜ å°„å…³ç³»ä¿å­˜ä¸‹æ¥ï¼Œç¡®ä¿ Clash é‡å¯åä¾ç„¶èƒ½ä½¿ç”¨ç›¸åŒçš„ Fake IP åˆ†é…ç»™ç›¸åŒçš„åŸŸåï¼Œä¿æŒè¿æ¥çš„ä¸€è‡´æ€§å’Œç¨³å®šæ€§

# åŸŸåå—…æ¢
sniffer:
  enable: true                   # å¯ç”¨ç½‘ç»œæµé‡å—…æ¢åŠŸèƒ½ï¼Œå…è®¸ Clash åˆ†æå’Œè¯†åˆ«æµé‡ç±»å‹
  sniff:
    TLS:
      ports: [443, 8443]         # è¦å—…æ¢çš„ TLS æµé‡ç«¯å£ï¼ŒåŒ…æ‹¬æ ‡å‡† HTTPS ç«¯å£ 443 å’Œå¸¸ç”¨çš„å¤‡ç”¨ HTTPS ç«¯å£ 8443
    HTTP:
      ports: [80, 8080-8880]     # è¦å—…æ¢çš„ HTTP æµé‡ç«¯å£ï¼ŒåŒ…æ‹¬æ ‡å‡† HTTP ç«¯å£ 80 å’Œå¸¸ç”¨çš„ HTTP ç«¯å£èŒƒå›´ 8080-8880
      override-destination: true # å¯ç”¨ç›®æ ‡è¦†ç›–åŠŸèƒ½ï¼Œå…è®¸ Clash æ ¹æ®å—…æ¢åˆ°çš„åŸŸåé‡å†™è¯·æ±‚çš„ç›®æ ‡åœ°å€

# GeoData é…ç½®
geodata-mode: true        # å¯ç”¨åœ°ç†æ•°æ®æ¨¡å¼ï¼Œä½¿ Clash ä½¿ç”¨ GeoIP/GeoSite æ•°æ®åº“è¿›è¡Œæµé‡çš„åœ°ç†ä½ç½®è¯†åˆ«å’Œè§„åˆ™åŒ¹é…
geo-auto-update: true     # å¯ç”¨åœ°ç†æ•°æ®åº“è‡ªåŠ¨æ›´æ–°åŠŸèƒ½ï¼ŒClash ä¼šå®šæœŸæ£€æŸ¥å¹¶æ›´æ–° GeoIP/GeoSite æ•°æ®åº“
geo-update-interval: 24   # è®¾ç½®åœ°ç†æ•°æ®åº“çš„æ›´æ–°é—´éš”ä¸º24å°æ—¶ï¼ŒClash ä¼šæ¯24å°æ—¶è‡ªåŠ¨æ£€æŸ¥ä¸€æ¬¡æ›´æ–°ï¼ˆå°æ—¶ï¼‰
geodata-loader: standard  # è®¾ç½®åœ°ç†æ•°æ®åŠ è½½å™¨ä¸ºæ ‡å‡†æ¨¡å¼ï¼Œä½¿ç”¨æ ‡å‡†çš„æ•°æ®è§£æå’ŒåŠ è½½æ–¹å¼å¤„ç†åœ°ç†æ•°æ®åº“
# GeoDataä¸‹è½½æºï¼ˆä½¿ç”¨å›½å†…åŠ é€Ÿä¸‹è½½æºï¼‰
# å¤‡ç”¨ä¸‹è½½åŸŸåhttps://ghfast.topã€https://ghproxy.netã€https://ghgo.xyz
geox-url:
  geoip: https://fastgh.lainbo.com/https://github.com/MetaCubeX/meta-rules-dat/releases/download/latest/geoip-lite.dat
  geosite: https://fastgh.lainbo.com/https://github.com/MetaCubeX/meta-rules-dat/releases/download/latest/geosite.dat
  mmdb: https://fastgh.lainbo.com/https://github.com/MetaCubeX/meta-rules-dat/releases/download/latest/country-lite.mmdb
  asn: https://fastgh.lainbo.com/https://github.com/xishang0128/geoip/releases/download/latest/GeoLite2-ASN.mmdb
#+end_src

* sing-box
Windows Tun é˜²ç«å¢™é—®é¢˜ï¼Œéœ€è¦æ‰‹åŠ¨è¿è¡Œä¸€æ¬¡æç¤ºæ”¾è¡Œï¼š
gsudo sing-box run -c coonfig.json

#+begin_src bash
jq 'del(.inbounds[] | select(.type == "tun"))' feiji.json > config.json
sing-box merge -c feiji.json -c sb-tun.json config.json
journalctl -u sing-box -f --output=cat
#+end_src

** GUI.for.SingBox
æ—¥å¿—æ—¶é—´æˆ³ / apiåœ°å€ 9090 / apiå¯†é’¥ 1984 / uiè·¯å¾„ ui / å…è®¸ç§æœ‰ç½‘ç»œè®¿é—®
https://gh-proxy.com/https://github.com/Zephyruso/zashboard/releases/latest/download/dist.zip
mixed-in ç›‘å¬åœ°å€æ”¹ :: 7890
æ‰“å¼€ tunï¼Œæ¨¡å¼å †æ ˆé€‰ system
å‡ºç«™è®¾ç½®ï¼šğŸš€ èŠ‚ç‚¹é€‰æ‹© ğŸˆ è‡ªåŠ¨é€‰æ‹© åˆ†åˆ«é€‰æ‹©è®¢é˜…èŠ‚ç‚¹
è·¯ç”±è®¾ç½®â€”â€”è§„åˆ™ï¼šåˆ é™¤ reject quic
# DNSè®¾ç½®â€”â€”æœåŠ¡å™¨â€”â€”Local-DNS: h3://223.5

https://linux.do/t/topic/938696

** inbounds

mtu: The maximum transmission unit.

"listen": "127.0.0.1", : ipv4
"listen": "::", ï¼šipv6

listen_port
sudo lsof -i :7890
netstat -ano | findstr :7890 // windows

*** tun
Defaults to the mixed stack if the gVisor build tag is enabled, otherwise defaults to the system stack.

system ä½¿ç”¨ç³»ç»Ÿåè®®æ ˆï¼Œå¯ä»¥æä¾›æ›´ç¨³å®š/å…¨é¢çš„ tun ä½“éªŒï¼Œä¸”å ç”¨ç›¸å¯¹å…¶ä»–å †æ ˆæ›´ä½
gvisor é€šè¿‡åœ¨ç”¨æˆ·ç©ºé—´ä¸­å®ç°ç½‘ç»œåè®®æ ˆï¼Œå¯ä»¥æä¾›æ›´é«˜çš„å®‰å…¨æ€§å’Œéš”ç¦»æ€§ï¼ŒåŒæ—¶å¯ä»¥é¿å…æ“ä½œç³»ç»Ÿå†…æ ¸å’Œç”¨æˆ·ç©ºé—´ä¹‹é—´çš„åˆ‡æ¢ï¼Œä»è€Œåœ¨ç‰¹å®šæƒ…å†µä¸‹å…·æœ‰æ›´å¥½çš„ç½‘ç»œå¤„ç†æ€§èƒ½
mixed æ··åˆå †æ ˆï¼Œtcp ä½¿ç”¨ system æ ˆï¼Œudp ä½¿ç”¨ gvisor æ ˆï¼Œä½¿ç”¨ä½“éªŒå¯èƒ½ç›¸å¯¹æ›´å¥½

#+begin_src json
{
    "type": "tun",
    "tag": "tun-in",
    "address": [
        "172.18.0.1/30",
        "fdfe:dcba:9876::1/126"
    ],
    "auto_route": true,
    "strict_route": true
},
#+end_src

*** mixed
mixed: inbound is a socks4, socks4a, socks5 and http server.

#+begin_src json
{
    "type": "mixed",
    "tag": "mixed-in",
    "listen": "127.0.0.1",
    "listen_port": 7890
}
#+end_src

*** tproxy

#+begin_src json
{
    "type": "tproxy",
    "tag": "tproxy-in",
    "listen": "0.0.0.0",
    "listen_port": 7895
}
#+end_src

** providers
outbounds â€”â€” èŠ‚ç‚¹é€‰æ‹©/è‡ªåŠ¨é€‰æ‹© æ·»åŠ ï¼š

#+begin_src json
"use_all_providers": true,
#+end_src

#+begin_src json
  "providers": [
    {
      "type": "remote",
      "tag": "sub1",
      "url": "",
      "user_agent": "sing-box",
      "download_detour": "ğŸ¯ å…¨çƒç›´è¿",
      "update_interval": "24h",
      "override_dialer": {}
    },
    {
      "type": "remote",
      "tag": "sub2",
      "url": "",
      "user_agent": "sing-box",
      "download_detour": "ğŸ¯ å…¨çƒç›´è¿",
      "update_interval": "24h",
      "override_dialer": {}
    },
    {
      "type": "remote",
      "tag": "sub3",
      "url": "",
      "user_agent": "sing-box",
      "download_detour": "ğŸ¯ å…¨çƒç›´è¿",
      "update_interval": "24h",
      "override_dialer": {}
    }
  ]
#+end_src

** dns

tls: DNS over TLS (DoT)
quic: DNS over QUIC (DoQ)
https: DNS over HTTPS (DoH)
h3: DNS over HTTP3 (DoH3) *recommend*

** experimental
cache_file enabled: required to save rule-set cache.

#+begin_src json
{
  "experimental": {
    "clash_api": {
      "external_controller": "127.0.0.1:9090",
      "external_ui": "ui",
      "external_ui_download_url": "https://gh-proxy.com/https://github.com/Zephyruso/zashboard/releases/latest/download/dist.zip",
      "secret": "1984",
      "default_mode": "rule",
      "external_ui_download_detour": "ğŸš€ èŠ‚ç‚¹é€‰æ‹©",
      "access_control_allow_private_network": true,
      "access_control_allow_origin": [
        "http://127.0.0.1",
        "https://yacd.metacubex.one",
        "https://metacubex.github.io",
        "https://metacubexd.pages.dev",
        "https://board.zash.run.place"
      ]
    }
  }
}
#+end_src

** Links
https://sing-box.sagernet.org/zh/configuration/
https://icloudnative.io/posts/sing-box-tutorial/
https://linux.do/t/topic/1164538#p-10270168-sing-box-7

https://github.com/qichiyuhub/sbshell tproxy
https://github.com/Toperlock/sing-box-subscribe æ¨¡æ¿
https://github.com/bestnite/sub2sing-box

* sub-store

å®‰è£…ï¼š
#+begin_src bash
wget https://github.com/sub-store-org/Sub-Store/releases/latest/download/sub-store.bundle.js
wget https://github.com/sub-store-org/Sub-Store-Front-End/releases/latest/download/dist.zip && unzip dist.zip && rm dist.zip && mv dist frontend
pushd ~/code/sub/sub-store > /dev/null && xdg-open http://127.0.0.1:3000 ; node sub-store.bundle.js & ; popd > /dev/null
#+end_src

æ•™ç¨‹ï¼š
https://linux.do/t/topic/846616

æ–‡ä»¶ç®¡ç† - åˆ›å»ºæ–‡ä»¶ - config.json

æ¨¡æ¿ï¼š
https://raw.githubusercontent.com/zendo/nsworld/refs/heads/main/dotfiles/misc/sb-template.json

è„šæœ¬ï¼š
https://raw.githubusercontent.com/xream/scripts/main/surge/modules/sub-store-scripts/sing-box/template.js#name=liangxin&outbound=%F0%9F%95%B3%E2%84%B9%EF%B8%8F%F0%9F%8E%88%20%E8%87%AA%E5%8A%A8%E9%80%89%E6%8B%A9%F0%9F%95%B3%E2%84%B9%EF%B8%8F%F0%9F%9A%80%20%E8%8A%82%E7%82%B9%E9%80%89%E6%8B%A9&type=%E8%BF%9C%E7%A8%8B%E8%AE%A2%E9%98%85
